<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎßõÏßë Î£∞Î†õ - Ïò§Îäò Î≠ê Î®πÏßÄ?</title>
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Gaegu', cursive;
            background: #FFFFFF;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        .container {
            text-align: center;
            padding: 2rem;
            max-width: 800px;
            width: 95%;
        }

        .main-title {
            font-size: 4.5rem;
            color: #000000;
            margin-bottom: 5rem;
            text-shadow: 3px 3px 0px rgba(255, 255, 255, 0.8);
            transform: rotate(-2deg);
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.5rem;
            color: #9B59B6;
            margin-bottom: 3rem;
            transform: rotate(1deg);
        }

        .roulette-container {
            position: relative;
            width: 550px;  /* Îçî ÌÅ¨Í≤å */
            height: 550px; /* Îçî ÌÅ¨Í≤å */
            margin: 0 auto 2rem;
        }

        .roulette {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22rem;  /* Îçî ÌÅ¨Í≤å */
            color: #FF69B4;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 70%, rgba(255,255,255,0.3) 100%);
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.3);
        }

        .roulette:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(255, 105, 180, 0.5);
        }

        .roulette:hover .roulette-emoji {
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.3));
        }

        .roulette.spinning {
            animation: spin 3s cubic-bezier(0.4, 0.0, 0.2, 1);
        }



        @keyframes spin {
            0% { 
                transform: rotate(0deg) scale(1); 
            }
            100% { 
                transform: rotate(3600deg) scale(1); 
            }
        }

        .roulette-text {
            position: absolute;
            bottom: 30px;  /* 20px * 1.5 */
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.8rem;  /* 1.2rem * 1.5 */
            font-weight: 700;
            color: #FF69B4;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.9);
            z-index: 10;
            white-space: nowrap;
            background: rgba(255, 255, 255, 0.8);
            padding: 0.75rem 1.5rem;  /* 0.5rem * 1.5, 1rem * 1.5 */
            border-radius: 30px;  /* 20px * 1.5 */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .result-display {
            min-height: 100px;
            font-size: 2rem;
            font-weight: 700;
            color: #FF1493;
            text-shadow: 2px 2px 0px rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            margin-top: 1rem;
        }

        .restaurant-info {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 2.5rem;
            margin-top: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            text-align: center;
        }

        .restaurant-name {
            font-size: 1.8rem;
            color: #666;
            margin-bottom: 1rem;
            font-weight: 400;
        }

        .restaurant-category {
            font-size: 1.8rem;
            color: #FF69B4;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .restaurant-details {
            font-size: 1.2rem;
            color: #666;
            line-height: 1.5;
        }

        .loading {
            font-size: 1.5rem;
            color: #9B59B6;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ÌïòÎäòÏóêÏÑú ÏùåÏãùÏù¥ ÎÇ¥Î†§Ïò§Îäî Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .food-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
        }

        /* ÏùåÏãù ÎπÑ Ìö®Í≥º Í∞úÏÑ† */
        .falling-food {
            position: absolute;
            font-size: 2.5rem;
            animation: fallDown 3s ease-in forwards;
            opacity: 0;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        @keyframes fallDown {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(var(--rotation, 360deg));
                opacity: 0;
            }
        }















        /* ÏùåÏãù Ïù¥Î™®ÏßÄ Î∞∞Ïó¥ */
        .food-emojis {
            font-size: 1.5rem;
            margin: 0 0.2rem;
        }

        /* Í≥†Ìï¥ÏÉÅÎèÑ Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ïö© (Í∞ÄÏû• ÌôïÏã§Ìïú Î∞©Î≤ï) */
        .roulette-image {
            width: 60%;
            height: 60%;
            object-fit: contain;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
                width: 100%;
            }
            
            .main-title {
                font-size: 2.8rem;
                margin-bottom: 3rem;
                line-height: 1.1;
            }
            
            .subtitle {
                font-size: 1.2rem;
                margin-bottom: 2rem;
            }
            
            .roulette-container {
                width: 280px;
                height: 280px;
                margin: 0 auto 3rem;
            }
            
            .roulette {
                font-size: 12rem;
                background: radial-gradient(circle, rgba(255,255,255,0.95) 0%, rgba(255,182,193,0.3) 70%, rgba(255,105,180,0.2) 100%);
                box-shadow: 0 8px 25px rgba(255, 105, 180, 0.4), 
                           inset 0 2px 10px rgba(255,255,255,0.8);
                border: 3px solid rgba(255,105,180,0.1);
            }
            
            .roulette:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }
            
            .roulette-text {
                font-size: 1.4rem;
                bottom: 15px;
                color: #FF69B4;
                font-weight: 700;
                text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
            }
            
            .result-display {
                font-size: 1.6rem;
                padding: 1.5rem;
                margin-top: 2rem;
                border-radius: 20px;
                background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,182,193,0.1) 100%);
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                backdrop-filter: blur(10px);
            }
            
            .result-display.show {
                animation: slideUpFade 0.5s ease-out;
            }
            
            .falling-food {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 480px) {
            .main-title {
                font-size: 2.2rem;
                margin-bottom: 2rem;
            }
            
            .roulette-container {
                width: 240px;
                height: 240px;
            }
            
            .roulette {
                font-size: 10rem;
            }
            
            .roulette-text {
                font-size: 1.2rem;
                bottom: 12px;
            }
            
            .result-display {
                font-size: 1.4rem;
                padding: 1rem;
                margin-top: 1.5rem;
            }
        }
        
        @keyframes slideUpFade {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="food-rain" id="foodRain"></div>
    
    
    <div class="container">
        <h1 class="main-title">Ïò§Îäò Î≠ê Î®πÏßÄ? üéØ</h1>
        
        <div class="roulette-container">
            <div class="roulette" id="roulette" onclick="spinRoulette()">
                üçΩÔ∏è
                <div class="roulette-text" id="rouletteText">ÌÅ¥Î¶≠!</div>
            </div>
        </div>

        
        <div class="result-display" id="result">
        </div>
    </div>

    <script>
        // Î£∞Î†õ ÏÑ†ÌÉùÏßÄ Ï†ïÏùò (PRD Í∏∞Î∞ò)
        const choices = [
            { name: 'Íµ∂Ïñ¥', weight: 15, type: 'skip', emoji: 'üö´', message: 'Íµ∂Ïñ¥!' },
            { name: 'ÎùºÎ©¥', weight: 10, type: 'ramen', emoji: 'üçú', message: 'ÎùºÎ©¥' },
            { name: 'ÏßëÎ∞•', weight: 10, type: 'home', emoji: 'üçö', message: 'ÎÉâÏû•Í≥† ÌÑ∏Ïñ¥Ïöî' },
            { name: 'ÎßõÏßë', weight: 65, type: 'restaurant', emoji: 'üç¥', message: 'ÎßõÏßë Ï∞æÎäî Ï§ë...' }
        ];

        let isSpinning = false;
        let currentLocation = null;

        // Ïπ¥Ïπ¥Ïò§ Î°úÏª¨ API ÏÑ§Ï†ï
        // üîë Ïπ¥Ïπ¥Ïò§ API ÌÇ§ ÏÑ§Ï†ï Î∞©Î≤ï:
        // 1. https://developers.kakao.com/ Ï†ëÏÜç
        // 2. Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÏÉùÏÑ± ÌõÑ REST API ÌÇ§ Î≥µÏÇ¨
        // 3. config.js ÌååÏùºÏóêÏÑú YOUR_KAKAO_API_KEYÎ•º Ïã§Ï†ú ÌÇ§Î°ú ÍµêÏ≤¥
        const KAKAO_API_URL = '/api/kakao/search';

        

        // Ï¢åÌëúÎ°ú ÏßÄÏó≠Î™Ö Í∞ÄÏ†∏Ïò§Í∏∞
        const KAKAO_GEO_URL = '/api/kakao/geo';

        // Îëê ÏßÄÏ†ê Í∞Ñ Í±∞Î¶¨ Í≥ÑÏÇ∞
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // ÏßÄÍµ¨ Î∞òÏßÄÎ¶Ñ (km)
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return Math.round(R * c * 1000); // ÎØ∏ÌÑ∞ Îã®ÏúÑ
        }

        // Ïπ¥Ïπ¥Ïò§ APIÎ°ú ÏùåÏãùÏ†ê Í≤ÄÏÉâ
        async function searchRestaurants(lat, lng, radius = 1000) {
            try {
                const params = new URLSearchParams({
                    query: 'ÏùåÏãùÏ†ê',
                    x: lng,      // Í≤ΩÎèÑ
                    y: lat,      // ÏúÑÎèÑ  
                    radius: radius,
                    size: 15,    // ÏµúÎåÄ 15Í∞ú
                    category_group_code: 'FD6'  // ÏùåÏãùÏ†ê Ïπ¥ÌÖåÍ≥†Î¶¨
                });

                console.log('API ÏöîÏ≤≠ URL:', `${KAKAO_API_URL}?${params}`);
                

                const response = await fetch(`${KAKAO_API_URL}?${params}`);

                console.log('API ÏùëÎãµ ÏÉÅÌÉú:', response.status);

                if (!response.ok) {
                    throw new Error(`API ÏöîÏ≤≠ Ïã§Ìå®: ${response.status}`);
                }

                const data = await response.json();
                console.log('API ÏùëÎãµ Îç∞Ïù¥ÌÑ∞:', data);
                
                return data.documents || [];
            } catch (error) {
                console.error('ÏùåÏãùÏ†ê Í≤ÄÏÉâ Ïã§Ìå®:', error);
                throw error;
            }
        }

        // ÏòÅÏóÖÏãúÍ∞Ñ ÌååÏã± Î∞è Ï≤¥ÌÅ¨ (Ïπ¥Ïπ¥Ïò§ API ÏùëÎãµ Íµ¨Ï°∞Ïóê ÎßûÍ≤å ÏàòÏ†ï)
        function parseOpeningHours(openingHours) {
            if (!openingHours) return null;
            
            // Ïπ¥Ïπ¥Ïò§ API ÏùëÎãµÏóêÏÑú ÏòÅÏóÖÏãúÍ∞Ñ Ï†ïÎ≥¥ Ï∂îÏ∂ú
            // ÏòàÏãú: "Îß§Ïùº 11:30 ~ 23:00" ÎòêÎäî "Ïõî-Í∏à 09:00-18:00"
            const timeMatch = openingHours.match(/(\d{1,2}):(\d{2})\s*[~-]\s*(\d{1,2}):(\d{2})/);
            if (timeMatch) {
                const openHour = parseInt(timeMatch[1]);
                const openMinute = parseInt(timeMatch[2]);
                const closeHour = parseInt(timeMatch[3]);
                const closeMinute = parseInt(timeMatch[4]);
                
                return {
                    open: openHour * 60 + openMinute,
                    close: closeHour * 60 + closeMinute,
                    original: openingHours
                };
            }
            return null;
        }

        // ÌòÑÏû¨ ÏòÅÏóÖÏ§ëÏù∏ÏßÄ ÌôïÏù∏ (ÎßàÍ∞ê 1ÏãúÍ∞Ñ Ï†ÑÍπåÏßÄÎßå)
        function isRestaurantAvailable(restaurant, currentTime) {
            // ÏòÅÏóÖÏãúÍ∞Ñ Ï†ïÎ≥¥Í∞Ä ÏûàÎäî Í≤ΩÏö∞ÏóêÎßå Ï≤¥ÌÅ¨
            const hours = parseOpeningHours(restaurant.opening_hours);
            if (!hours) {
                // ÏòÅÏóÖÏãúÍ∞Ñ Ï†ïÎ≥¥Í∞Ä ÏóÜÏúºÎ©¥ Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Ïù¥Ïö© Í∞ÄÎä•
                return true;
            }
            
            // ÌòÑÏû¨ ÏãúÍ∞ÑÏù¥ ÏòÅÏóÖÏãúÍ∞Ñ ÎÇ¥Ïù∏ÏßÄ ÌôïÏù∏
            const isCurrentlyOpen = currentTime >= hours.open && currentTime <= hours.close;
            
            // ÎßàÍ∞ê 1ÏãúÍ∞Ñ Ï†ÑÍπåÏßÄÎßå Ïù¥Ïö© Í∞ÄÎä•
            const oneHourBeforeClosing = hours.close - 60;
            const hasEnoughTime = currentTime <= oneHourBeforeClosing;
            
            console.log(`ÏùåÏãùÏ†ê: ${restaurant.place_name}`);
            console.log(`ÌòÑÏû¨ÏãúÍ∞Ñ: ${Math.floor(currentTime/60)}:${currentTime%60}`);
            console.log(`ÏòÅÏóÖÏãúÍ∞Ñ: ${Math.floor(hours.open/60)}:${hours.open%60} ~ ${Math.floor(hours.close/60)}:${hours.close%60}`);
            console.log(`ÏòÅÏóÖÏ§ë: ${isCurrentlyOpen}, Ï∂©Î∂ÑÌïúÏãúÍ∞Ñ: ${hasEnoughTime}`);
            
            return isCurrentlyOpen && hasEnoughTime;
        }

        // ÎûúÎç§ ÎßõÏßë ÏÑ†ÌÉù
        async function getRandomRestaurant(lat, lng) {
            try {
                // ÌòÑÏû¨ ÏãúÍ∞Ñ
                const now = new Date();
                const currentHour = now.getHours();
                const currentMinutes = now.getMinutes();
                const currentTime = currentHour * 60 + currentMinutes; // Î∂ÑÏúºÎ°ú Î≥ÄÌôò
                
                // Ïπ¥Ïπ¥Ïò§ APIÎ°ú 1km ÎÇ¥ Î™®Îì† ÏùåÏãùÏ†ê Í≤ÄÏÉâ (ÏïàÏ†ïÏ†Å)
                const allRestaurants = await searchRestaurants(lat, lng, 1000);
                
                console.log('Í≤ÄÏÉâÎêú ÏùåÏãùÏ†ê:', allRestaurants);
                
                // ÏòÅÏóÖÏ§ë + ÎßàÍ∞ê 1ÏãúÍ∞Ñ Ï†ÑÍπåÏßÄÎßå ÌïÑÌÑ∞ÎßÅ
                const availableRestaurants = allRestaurants.filter(restaurant => {
                    return isRestaurantAvailable(restaurant, currentTime);
                });
                
                console.log('Ïù¥Ïö© Í∞ÄÎä•Ìïú ÏùåÏãùÏ†ê:', availableRestaurants);
                
                if (availableRestaurants.length === 0) {
                    throw new Error('ÌòÑÏû¨ Ïù¥Ïö© Í∞ÄÎä•Ìïú ÎßõÏßëÏù¥ ÏóÜÏäµÎãàÎã§');
                }
                
                // ÌïÑÌÑ∞ÎßÅÎêú Í≤∞Í≥ºÏóêÏÑú ÎûúÎç§ ÏÑ†ÌÉù
                const randomIndex = Math.floor(Math.random() * availableRestaurants.length);
                return availableRestaurants[randomIndex];
            } catch (error) {
                console.error('ÎßõÏßë ÏÑ†ÌÉù Ïã§Ìå®:', error);
                throw error;
            }
        }

        // ÏßÄÎèÑÎ≥¥Í∏∞ Í∏∞Îä•
        function openMap(placeName, x, y) {
            // Ïπ¥Ïπ¥Ïò§ÎßµÏúºÎ°ú Ïó¥Í∏∞
            const url = `https://map.kakao.com/link/map/${placeName},${y},${x}`;
            window.open(url, '_blank');
        }

        // ÏúÑÏπò Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
        function getCurrentLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('GeolocationÏù¥ ÏßÄÏõêÎêòÏßÄ ÏïäÏäµÎãàÎã§.'));
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        currentLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        };
                        console.log('ÌòÑÏû¨ ÏúÑÏπò:', currentLocation);
                        resolve(currentLocation);
                    },
                    (error) => {
                        console.error('ÏúÑÏπò Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®:', error);
                        reject(error);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            });
        }

        // ÏúÑÏπò Í∂åÌïú ÏöîÏ≤≠ Î∞è ÌôïÏù∏
        async function requestLocationPermission() {
            try {
                await getCurrentLocation();
                return true;
            } catch (error) {
                console.error('ÏúÑÏπò Í∂åÌïú Ïò§Î•ò:', error);
                return false;
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏúÑÏπò Í∂åÌïú ÏöîÏ≤≠
        window.addEventListener('load', async () => {
            const hasLocation = await requestLocationPermission();
            if (!hasLocation) {
                console.log('ÏúÑÏπò Í∂åÌïúÏù¥ Í±∞Î∂ÄÎêòÏóàÏäµÎãàÎã§. ÎßõÏßë Í∏∞Îä•ÏùÄ Ï†úÌïúÎê©ÎãàÎã§.');
            }
        });

        function weightedRandom(choices) {
            const totalWeight = choices.reduce((sum, choice) => sum + choice.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (let choice of choices) {
                random -= choice.weight;
                if (random <= 0) return choice;
            }
            return choices[choices.length - 1]; // fallback
        }

        async function spinRoulette() {
            if (isSpinning) return;
            
            isSpinning = true;
            const roulette = document.getElementById('roulette');
            const rouletteText = document.getElementById('rouletteText');
            const result = document.getElementById('result');
            
            // Î£∞Î†õ ÎπÑÌôúÏÑ±Ìôî (ÌÅ¥Î¶≠ Î∞©ÏßÄ)
            roulette.style.pointerEvents = 'none';
            rouletteText.textContent = 'ÎèåÎ¶¨Îäî Ï§ë...';
            
                        // ÏùåÏãù ÎπÑ Ïï†ÎãàÎ©îÏù¥ÏÖò ÏãúÏûë
            createFoodRain();
            
            // Î£∞Î†õ ÌöåÏ†Ñ Ïï†ÎãàÎ©îÏù¥ÏÖò
            roulette.classList.add('spinning');
            
            // ÎûúÎç§ ÏÑ†ÌÉù
            const selectedChoice = weightedRandom(choices);
            
            setTimeout(async () => {
                roulette.classList.remove('spinning');
                rouletteText.textContent = 'ÌÅ¥Î¶≠!';
                
                // Í≤∞Í≥º ÌëúÏãú
                result.classList.remove('show');
                if (selectedChoice.type === 'restaurant') {
                    result.innerHTML = '<div class="loading">üç¥ ÎßõÏßë Ï∞æÎäî Ï§ë...</div>';
                    result.classList.add('show');
                    
                    // ÏúÑÏπò Ï†ïÎ≥¥ ÌôïÏù∏
                    if (!currentLocation) {
                        try {
                            await getCurrentLocation();
                        } catch (error) {
                            result.innerHTML = '<div class="restaurant-info"><div class="restaurant-name">‚ö†Ô∏è ÏúÑÏπò Ï†ïÎ≥¥ ÌïÑÏöî</div><div class="restaurant-details">ÏúÑÏπò Í∂åÌïúÏùÑ ÌóàÏö©Ìï¥Ï£ºÏÑ∏Ïöî.<br>ÎßõÏßë Ï∂îÏ≤úÏùÑ ÏúÑÌï¥ ÌòÑÏû¨ ÏúÑÏπòÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.</div></div>';
                            result.classList.add('show');
                            roulette.style.pointerEvents = 'auto';
                            isSpinning = false;
                            return;
                        }
                    }
                    
                    // Ïã§Ï†ú ÎßõÏßë API Ìò∏Ï∂ú
                    try {
                        const restaurant = await getRandomRestaurant(currentLocation.latitude, currentLocation.longitude);
                        
                        console.log('ÏÑ†ÌÉùÎêú ÎßõÏßë:', restaurant);
                        
                        // Í±∞Î¶¨ Í≥ÑÏÇ∞ (Ïã§Ï†ú Í±∞Î¶¨ Ï†ïÎ≥¥Í∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ ÏûÑÏãú)
                        const distance = restaurant.distance ? Math.round(restaurant.distance) : Math.round(Math.random() * 800 + 200);
                        
                        // ÎßàÍ∞êÏãúÍ∞Ñ Í≥ÑÏÇ∞
                        const hours = parseOpeningHours(restaurant.opening_hours);
                        let closingTime = 'Ï†ïÎ≥¥ ÏóÜÏùå';
                        let isOpen = 'ÏòÅÏóÖÏ§ë';
                        
                        if (hours && hours.original) {
                            closingTime = hours.original;
                            // Í∞ÑÎã®Ìïú ÏòÅÏóÖÏ§ë Ï≤¥ÌÅ¨ (ÌòÑÏû¨ ÏãúÍ∞ÑÏù¥ ÏòÅÏóÖÏãúÍ∞Ñ ÎÇ¥Ïù∏ÏßÄ)
                            const now = new Date();
                            const currentTime = now.getHours() * 60 + now.getMinutes();
                            if (currentTime >= hours.open && currentTime <= hours.close) {
                                isOpen = 'ÏòÅÏóÖÏ§ë';
                            } else {
                                isOpen = 'ÏòÅÏóÖÏ¢ÖÎ£å';
                            }
                        } else {
                            isOpen = 'ÏòÅÏóÖÏ†ïÎ≥¥ ÏóÜÏùå';
                        }
                        
                        // Î≥ÑÏ†ê Ï†ïÎ≥¥ (Ïπ¥Ïπ¥Ïò§ APIÏóêÏÑúÎäî Î≥ÑÏ†ê Ï†ïÎ≥¥Í∞Ä Ï†úÌïúÏ†Å)
                        const rating = restaurant.rating || 'N/A';
                        const category = restaurant.category_name || '';
                        
                        // Í∞ÄÏû• ÌïòÏúÑ Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÏ∂ú
                        let subCategory = '';
                        if (category) {
                            const categories = category.split(' > ');
                            subCategory = categories[categories.length - 1] || '';
                        }
                        
                        result.innerHTML = `
                            <div class="restaurant-info">
                                <div class="restaurant-category">${subCategory || 'ÎßõÏßë'}</div>
                                <div class="restaurant-name">üç¥ ${restaurant.place_name} (${distance}m)</div>
                                <button onclick="openMap('${restaurant.place_name}', ${restaurant.x}, ${restaurant.y})" 
                                        style="margin-top: 1.5rem; padding: 0.8rem 1.5rem; background: #FF69B4; color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 1.2rem; font-weight: 600;">
                                    üó∫Ô∏è ÏßÄÎèÑÎ≥¥Í∏∞
                                </button>
                            </div>
                        `;
                        result.classList.add('show');
                    } catch (error) {
                        if (error.message.includes('Ïù¥Ïö© Í∞ÄÎä•Ìïú ÎßõÏßëÏù¥ ÏóÜÏäµÎãàÎã§')) {
                            result.innerHTML = '<div class="restaurant-info"><div class="restaurant-name">üòî Ïù¥Ïö© Í∞ÄÎä•Ìïú ÎßõÏßëÏù¥ ÏóÜÏñ¥Ïöî</div><div class="restaurant-details">ÎßàÍ∞êÏù¥ ÏûÑÎ∞ïÌñàÍ±∞ÎÇò ÏòÅÏóÖÏ§ëÏù∏ Í≥≥Ïù¥ ÏóÜÏäµÎãàÎã§.<br>Îã§Ïãú ÎèåÎ†§Î≥¥ÏÑ∏Ïöî!</div></div>';
                        } else {
                            result.innerHTML = '<div class="restaurant-info"><div class="restaurant-name">‚ö†Ô∏è ÎßõÏßë Í≤ÄÏÉâ Ïã§Ìå®</div><div class="restaurant-details">ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.<br>Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.</div></div>';
                        }
                        result.classList.add('show');
                    }
                } else {
                    result.innerHTML = `${selectedChoice.emoji}${selectedChoice.message}${selectedChoice.emoji}`;
                    result.classList.add('show');
                }
                
                roulette.style.pointerEvents = 'auto';
                isSpinning = false;
            }, 3000);
        }

        // ÏùåÏãù ÎπÑ Ïï†ÎãàÎ©îÏù¥ÏÖò
        function createFoodRain() {
            const foodRain = document.getElementById('foodRain');
            const foods = [
                'üçï', 'üçú', 'üçó', 'üçî', 'üçù', 'üçô', 'üç¢', 'üç£', 'ü•ì', 'üåÆ', 'ü•ó', 
                'üçï', 'üçú', 'üçó', 'üçî', 'üçù', 'üçô', 'üç¢', 'üç£', 'ü•ì', 'üåÆ', 'ü•ó',
                'üçï', 'üçú', 'üçó', 'üçî', 'üçù', 'üçô', 'üç¢', 'üç£', 'ü•ì', 'üåÆ', 'ü•ó'
            ];
            
            // Í∏∞Ï°¥ ÏùåÏãù ÏöîÏÜåÎì§ Ï†úÍ±∞
            foodRain.innerHTML = '';
            
            // 20Í∞úÏùò ÏùåÏãùÏùÑ ÎûúÎç§ÌïòÍ≤å ÏÉùÏÑ±
            for (let i = 0; i < 20; i++) {
                const food = document.createElement('div');
                food.className = 'falling-food';
                food.textContent = foods[Math.floor(Math.random() * foods.length)];
                
                // ÎûúÎç§ ÏúÑÏπòÏôÄ ÏßÄÏó∞ÏãúÍ∞Ñ
                food.style.left = Math.random() * 100 + '%';
                food.style.animationDelay = Math.random() * 2 + 's';
                food.style.animationDuration = (Math.random() * 1 + 2) + 's';
                
                // ÎûúÎç§ ÌöåÏ†Ñ Î∞©Ìñ•
                const rotation = Math.random() > 0.5 ? 360 : -360;
                food.style.setProperty('--rotation', rotation + 'deg');
                
                foodRain.appendChild(food);
                
                // Ïï†ÎãàÎ©îÏù¥ÏÖò ÏôÑÎ£å ÌõÑ ÏöîÏÜå Ï†úÍ±∞
                setTimeout(() => {
                    if (food.parentNode) {
                        food.remove();
                    }
                }, 5000);
            }
        }

                // ÏùåÏãù Ïù¥Î™®ÏßÄ Î∞∞Ïó¥
        const foodEmojis = ['üçï', 'üçú', 'üçó', 'üçî', 'üçù', 'üçô', 'üç¢', 'üç£', 'ü•ì', 'üçù', 'üåÆ', 'ü•ó'];



        
    </script>
</body>
</html> 
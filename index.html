<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§›ì§‘ ë£°ë › - ì˜¤ëŠ˜ ë­ ë¨¹ì§€?</title>
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Gaegu', cursive;
            background: linear-gradient(135deg, #FFD9EC 0%, #E6D9FF 25%, #D9FFEC 50%, #FFEAD9 75%, #FFF5D9 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        .container {
            text-align: center;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
        }

        .main-title {
            font-size: 3.5rem;
            color: #FF69B4;
            margin-bottom: 1rem;
            text-shadow: 3px 3px 0px rgba(255, 255, 255, 0.8);
            transform: rotate(-2deg);
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.5rem;
            color: #9B59B6;
            margin-bottom: 3rem;
            transform: rotate(1deg);
        }

        .roulette-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto 2rem;
        }

        .roulette {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            cursor: pointer;
            transition: transform 3s ease-out;
            background: conic-gradient(
                #FF6B6B 0deg 54deg,    /* êµ¶ì–´ 15% */
                #4ECDC4 54deg 90deg,   /* ë¼ë©´ 10% */
                #45B7D1 90deg 126deg,  /* ì§‘ë°¥ 10% */
                #96CEB4 126deg 360deg  /* ë§›ì§‘ 65% */
            );
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .roulette:hover {
            transform: scale(1.05);
        }

        .roulette.spinning {
            animation: spin 3s ease-out;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .roulette-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 10;
        }

        .spin-button {
            background: linear-gradient(45deg, #FF69B4, #FF1493);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.5rem;
            font-family: 'Gaegu', cursive;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4);
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }

        .spin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 105, 180, 0.6);
        }

        .spin-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result-display {
            min-height: 100px;
            font-size: 2rem;
            font-weight: 700;
            color: #FF1493;
            text-shadow: 2px 2px 0px rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            margin-top: 1rem;
        }

        .restaurant-info {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .restaurant-name {
            font-size: 1.8rem;
            color: #FF1493;
            margin-bottom: 0.5rem;
        }

        .restaurant-details {
            font-size: 1.2rem;
            color: #666;
            line-height: 1.5;
        }

        .loading {
            font-size: 1.5rem;
            color: #9B59B6;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @media (max-width: 768px) {
            .main-title {
                font-size: 2.5rem;
            }
            
            .subtitle {
                font-size: 1.2rem;
            }
            
            .roulette-container {
                width: 250px;
                height: 250px;
            }
            
            .roulette-text {
                font-size: 1.5rem;
            }
            
            .result-display {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="main-title">ì˜¤ëŠ˜ ë­ ë¨¹ì§€?</h1>
        <p class="subtitle">ë£°ë ›ì„ ëŒë ¤ë³´ì„¸ìš”! ğŸ¯</p>
        
        <div class="roulette-container">
            <div class="roulette" id="roulette">
                <div class="roulette-text" id="rouletteText">í´ë¦­!</div>
            </div>
        </div>
        
        <button class="spin-button" id="spinButton" onclick="spinRoulette()">
            ì‹ì‚¬ ë£°ë › ëŒë¦¬ê¸°
        </button>
        
        <div class="result-display" id="result">
        </div>
    </div>

    <script>
        // ë£°ë › ì„ íƒì§€ ì •ì˜ (PRD ê¸°ë°˜)
        const choices = [
            { name: 'êµ¶ì–´', weight: 15, type: 'skip', emoji: 'ğŸš«', message: 'êµ¶ì–´!' },
            { name: 'ë¼ë©´', weight: 10, type: 'ramen', emoji: 'ğŸœ', message: 'ë¼ë©´' },
            { name: 'ì§‘ë°¥', weight: 10, type: 'home', emoji: 'ğŸš', message: 'ëƒ‰ì¥ê³  í„¸ì–´ìš”' },
            { name: 'ë§›ì§‘', weight: 65, type: 'restaurant', emoji: 'ğŸ´', message: 'ë§›ì§‘ ì°¾ëŠ” ì¤‘...' }
        ];

        let isSpinning = false;
        let currentLocation = null;

        // ì¹´ì¹´ì˜¤ ë¡œì»¬ API ì„¤ì •
        const KAKAO_API_KEY = 'YOUR_KAKAO_API_KEY'; // ì‹¤ì œ API í‚¤ë¡œ êµì²´ í•„ìš”
        const KAKAO_API_URL = 'https://dapi.kakao.com/v2/local/search/keyword.json';

        // ì¹´ì¹´ì˜¤ APIë¡œ ìŒì‹ì  ê²€ìƒ‰
        async function searchRestaurants(lat, lng, radius = 1000) {
            try {
                const params = new URLSearchParams({
                    query: 'ìŒì‹ì ',
                    x: lng,      // ê²½ë„
                    y: lat,      // ìœ„ë„  
                    radius: radius,
                    size: 15,    // ìµœëŒ€ 15ê°œ
                    category_group_code: 'FD6'  // ìŒì‹ì  ì¹´í…Œê³ ë¦¬
                });

                const response = await fetch(`${KAKAO_API_URL}?${params}`, {
                    headers: {
                        'Authorization': `KakaoAK ${KAKAO_API_KEY}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`API ìš”ì²­ ì‹¤íŒ¨: ${response.status}`);
                }

                const data = await response.json();
                return data.documents || [];
            } catch (error) {
                console.error('ìŒì‹ì  ê²€ìƒ‰ ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // ì˜ì—…ì‹œê°„ íŒŒì‹± ë° ì²´í¬
        function parseOpeningHours(openingHours) {
            if (!openingHours) return null;
            
            // ì˜ˆì‹œ: "09:00~22:00"
            const match = openingHours.match(/(\d{2}):(\d{2})~(\d{2}):(\d{2})/);
            if (match) {
                const openHour = parseInt(match[1]);
                const openMinute = parseInt(match[2]);
                const closeHour = parseInt(match[3]);
                const closeMinute = parseInt(match[4]);
                
                return {
                    open: openHour * 60 + openMinute,
                    close: closeHour * 60 + closeMinute
                };
            }
            return null;
        }

        // í˜„ì¬ ì˜ì—…ì¤‘ì¸ì§€ í™•ì¸ (ë§ˆê° 1ì‹œê°„ ì „ê¹Œì§€ë§Œ)
        function isRestaurantAvailable(restaurant, currentTime) {
            const hours = parseOpeningHours(restaurant.opening_hours);
            if (!hours) return true; // ì˜ì—…ì‹œê°„ ì •ë³´ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ì´ìš© ê°€ëŠ¥
            
            const oneHourBeforeClosing = hours.close - 60;
            
            return currentTime >= hours.open && currentTime <= oneHourBeforeClosing;
        }

        // ëœë¤ ë§›ì§‘ ì„ íƒ
        async function getRandomRestaurant(lat, lng) {
            try {
                // í˜„ì¬ ì‹œê°„
                const now = new Date();
                const currentHour = now.getHours();
                const currentMinutes = now.getMinutes();
                const currentTime = currentHour * 60 + currentMinutes; // ë¶„ìœ¼ë¡œ ë³€í™˜
                
                // ì¹´ì¹´ì˜¤ APIë¡œ 1km ë‚´ ëª¨ë“  ìŒì‹ì  ê²€ìƒ‰
                const allRestaurants = await searchRestaurants(lat, lng, 1000);
                
                // ì˜ì—…ì¤‘ + ë§ˆê° 1ì‹œê°„ ì „ê¹Œì§€ë§Œ í•„í„°ë§
                const availableRestaurants = allRestaurants.filter(restaurant => {
                    return isRestaurantAvailable(restaurant, currentTime);
                });
                
                if (availableRestaurants.length === 0) {
                    throw new Error('í˜„ì¬ ì´ìš© ê°€ëŠ¥í•œ ë§›ì§‘ì´ ì—†ìŠµë‹ˆë‹¤');
                }
                
                // í•„í„°ë§ëœ ê²°ê³¼ì—ì„œ ëœë¤ ì„ íƒ
                const randomIndex = Math.floor(Math.random() * availableRestaurants.length);
                return availableRestaurants[randomIndex];
            } catch (error) {
                console.error('ë§›ì§‘ ì„ íƒ ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // ì§€ë„ë³´ê¸° ê¸°ëŠ¥
        function openMap(placeName, x, y) {
            // ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ì—´ê¸°
            const url = `https://map.kakao.com/link/map/${placeName},${y},${x}`;
            window.open(url, '_blank');
        }

        // ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        function getCurrentLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocationì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'));
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        currentLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        };
                        console.log('í˜„ì¬ ìœ„ì¹˜:', currentLocation);
                        resolve(currentLocation);
                    },
                    (error) => {
                        console.error('ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                        reject(error);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            });
        }

        // ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­ ë° í™•ì¸
        async function requestLocationPermission() {
            try {
                await getCurrentLocation();
                return true;
            } catch (error) {
                console.error('ìœ„ì¹˜ ê¶Œí•œ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­
        window.addEventListener('load', async () => {
            const hasLocation = await requestLocationPermission();
            if (!hasLocation) {
                console.log('ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë§›ì§‘ ê¸°ëŠ¥ì€ ì œí•œë©ë‹ˆë‹¤.');
            }
        });

        function weightedRandom(choices) {
            const totalWeight = choices.reduce((sum, choice) => sum + choice.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (let choice of choices) {
                random -= choice.weight;
                if (random <= 0) return choice;
            }
            return choices[choices.length - 1]; // fallback
        }

        async function spinRoulette() {
            if (isSpinning) return;
            
            isSpinning = true;
            const roulette = document.getElementById('roulette');
            const rouletteText = document.getElementById('rouletteText');
            const spinButton = document.getElementById('spinButton');
            const result = document.getElementById('result');
            
            // ë²„íŠ¼ ë¹„í™œì„±í™”
            spinButton.disabled = true;
            spinButton.textContent = 'ëŒë¦¬ëŠ” ì¤‘...';
            
            // ë£°ë › íšŒì „ ì• ë‹ˆë©”ì´ì…˜
            roulette.classList.add('spinning');
            rouletteText.textContent = 'ëŒì•„ê°€ëŠ”ì¤‘...';
            
            // ëœë¤ ì„ íƒ
            const selectedChoice = weightedRandom(choices);
            
            setTimeout(async () => {
                roulette.classList.remove('spinning');
                rouletteText.textContent = selectedChoice.emoji;
                
                // ê²°ê³¼ í‘œì‹œ
                if (selectedChoice.type === 'restaurant') {
                    result.innerHTML = '<div class="loading">ğŸ´ ë§›ì§‘ ì°¾ëŠ” ì¤‘...</div>';
                    
                    // ìœ„ì¹˜ ì •ë³´ í™•ì¸
                    if (!currentLocation) {
                        try {
                            await getCurrentLocation();
                        } catch (error) {
                            result.innerHTML = '<div class="restaurant-info"><div class="restaurant-name">âš ï¸ ìœ„ì¹˜ ì •ë³´ í•„ìš”</div><div class="restaurant-details">ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.<br>ë§›ì§‘ ì¶”ì²œì„ ìœ„í•´ í˜„ì¬ ìœ„ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.</div></div>';
                            spinButton.disabled = false;
                            spinButton.textContent = 'ë‹¤ì‹œ ëŒë¦¬ê¸°';
                            isSpinning = false;
                            return;
                        }
                    }
                    
                    // ì‹¤ì œ ë§›ì§‘ API í˜¸ì¶œ
                    try {
                        const restaurant = await getRandomRestaurant(currentLocation.latitude, currentLocation.longitude);
                        
                        // ê±°ë¦¬ ê³„ì‚° (ê°„ë‹¨í•œ ë²„ì „)
                        const distance = Math.round(Math.random() * 800 + 200); // ì„ì‹œ ê±°ë¦¬
                        
                        // ë§ˆê°ì‹œê°„ ê³„ì‚°
                        const hours = parseOpeningHours(restaurant.opening_hours);
                        let closingTime = 'ì •ë³´ ì—†ìŒ';
                        if (hours) {
                            const closeHour = Math.floor(hours.close / 60);
                            const closeMinute = hours.close % 60;
                            closingTime = `${closeHour.toString().padStart(2, '0')}:${closeMinute.toString().padStart(2, '0')}`;
                        }
                        
                        result.innerHTML = `
                            <div class="restaurant-info">
                                <div class="restaurant-name">ğŸ´ ${restaurant.place_name}</div>
                                <div class="restaurant-details">
                                    ğŸ“ ${restaurant.road_address_name || restaurant.address_name} (${distance}m)<br>
                                    â­ ${restaurant.rating || 'N/A'} | ğŸ•’ ${closingTime} ë§ˆê°<br>
                                    â˜ï¸ ${restaurant.phone || 'ë²ˆí˜¸ ì—†ìŒ'}
                                </div>
                                <button onclick="openMap('${restaurant.place_name}', ${restaurant.x}, ${restaurant.y})" 
                                        style="margin-top: 1rem; padding: 0.5rem 1rem; background: #FF69B4; color: white; border: none; border-radius: 10px; cursor: pointer;">
                                    ğŸ—ºï¸ ì§€ë„ë³´ê¸°
                                </button>
                            </div>
                        `;
                    } catch (error) {
                        if (error.message.includes('ì´ìš© ê°€ëŠ¥í•œ ë§›ì§‘ì´ ì—†ìŠµë‹ˆë‹¤')) {
                            result.innerHTML = '<div class="restaurant-info"><div class="restaurant-name">ğŸ˜” ì´ìš© ê°€ëŠ¥í•œ ë§›ì§‘ì´ ì—†ì–´ìš”</div><div class="restaurant-details">ë§ˆê°ì´ ì„ë°•í–ˆê±°ë‚˜ ì˜ì—…ì¤‘ì¸ ê³³ì´ ì—†ìŠµë‹ˆë‹¤.<br>ë‹¤ì‹œ ëŒë ¤ë³´ì„¸ìš”!</div></div>';
                        } else {
                            result.innerHTML = '<div class="restaurant-info"><div class="restaurant-name">âš ï¸ ë§›ì§‘ ê²€ìƒ‰ ì‹¤íŒ¨</div><div class="restaurant-details">ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div></div>';
                        }
                    }
                } else {
                    result.innerHTML = `${selectedChoice.emoji}${selectedChoice.message}${selectedChoice.emoji}`;
                }
                
                // ë²„íŠ¼ ë³µì›
                spinButton.disabled = false;
                spinButton.textContent = 'ë‹¤ì‹œ ëŒë¦¬ê¸°';
                isSpinning = false;
            }, 3000);
        }
    </script>
</body>
</html> 
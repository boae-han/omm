<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§›ì§‘ ë£°ë › - ì˜¤ëŠ˜ ë­ ë¨¹ì§€?</title>
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- API í‚¤ ì„¤ì • íŒŒì¼ ë¡œë“œ -->
    <script src="config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Gaegu', cursive;
            background: #FFFFFF;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }

        .container {
            text-align: center;
            padding: 2rem;
            max-width: 800px;
            width: 95%;
        }

        .main-title {
            font-size: 4.5rem;
            color: #000000;
            margin-bottom: 5rem;
            text-shadow: 3px 3px 0px rgba(255, 255, 255, 0.8);
            transform: rotate(-2deg);
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.5rem;
            color: #9B59B6;
            margin-bottom: 3rem;
            transform: rotate(1deg);
        }

        .roulette-container {
            position: relative;
            width: 550px;  /* ë” í¬ê²Œ */
            height: 550px; /* ë” í¬ê²Œ */
            margin: 0 auto 2rem;
        }

        .roulette {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22rem;  /* ë” í¬ê²Œ */
            color: #FF69B4;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 70%, rgba(255,255,255,0.3) 100%);
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.3);
        }

        .roulette:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(255, 105, 180, 0.5);
        }

        .roulette:hover .roulette-emoji {
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.3));
        }

        .roulette.spinning {
            animation: spin 3s cubic-bezier(0.4, 0.0, 0.2, 1);
        }



        @keyframes spin {
            0% { 
                transform: rotate(0deg) scale(1); 
            }
            100% { 
                transform: rotate(3600deg) scale(1); 
            }
        }

        .roulette-text {
            position: absolute;
            bottom: 30px;  /* 20px * 1.5 */
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.8rem;  /* 1.2rem * 1.5 */
            font-weight: 700;
            color: #FF69B4;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.9);
            z-index: 10;
            white-space: nowrap;
            background: rgba(255, 255, 255, 0.8);
            padding: 0.75rem 1.5rem;  /* 0.5rem * 1.5, 1rem * 1.5 */
            border-radius: 30px;  /* 20px * 1.5 */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .result-display {
            min-height: 100px;
            font-size: 2rem;
            font-weight: 700;
            color: #FF1493;
            text-shadow: 2px 2px 0px rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            margin-top: 1rem;
        }

        .restaurant-info {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 2.5rem;
            margin-top: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            text-align: center;
        }

        .restaurant-name {
            font-size: 1.8rem;
            color: #666;
            margin-bottom: 1rem;
            font-weight: 400;
        }

        .restaurant-category {
            font-size: 1.8rem;
            color: #FF69B4;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .restaurant-details {
            font-size: 1.2rem;
            color: #666;
            line-height: 1.5;
        }

        .loading {
            font-size: 1.5rem;
            color: #9B59B6;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* í•˜ëŠ˜ì—ì„œ ìŒì‹ì´ ë‚´ë ¤ì˜¤ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
        .food-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
        }

        /* ìŒì‹ ë¹„ íš¨ê³¼ ê°œì„  */
        .falling-food {
            position: absolute;
            font-size: 2.5rem;
            animation: fallDown 3s ease-in forwards;
            opacity: 0;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        @keyframes fallDown {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(var(--rotation, 360deg));
                opacity: 0;
            }
        }















        /* ìŒì‹ ì´ëª¨ì§€ ë°°ì—´ */
        .food-emojis {
            font-size: 1.5rem;
            margin: 0 0.2rem;
        }

        /* ê³ í•´ìƒë„ ì´ë¯¸ì§€ ì‚¬ìš© (ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•) */
        .roulette-image {
            width: 60%;
            height: 60%;
            object-fit: contain;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
        }

        @media (max-width: 768px) {
            .main-title {
                font-size: 3rem;
            }
            
            .subtitle {
                font-size: 1.2rem;
            }
            
            .roulette-container {
                width: 400px;
                height: 400px;
            }
            
            .roulette {
                font-size: 18rem;
            }
            
            .roulette-text {
                font-size: 1.8rem;
            }
            
            .result-display {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="food-rain" id="foodRain"></div>
    
    
    <div class="container">
        <h1 class="main-title">ì˜¤ëŠ˜ ë­ ë¨¹ì§€? ğŸ¯</h1>
        
        <div class="roulette-container">
            <div class="roulette" id="roulette" onclick="spinRoulette()">
                ğŸ½ï¸
                <div class="roulette-text" id="rouletteText">í´ë¦­!</div>
            </div>
        </div>

        
        <div class="result-display" id="result">
        </div>
    </div>

    <script>
        // ë£°ë › ì„ íƒì§€ ì •ì˜ (PRD ê¸°ë°˜)
        const choices = [
            { name: 'êµ¶ì–´', weight: 15, type: 'skip', emoji: 'ğŸš«', message: 'êµ¶ì–´!' },
            { name: 'ë¼ë©´', weight: 10, type: 'ramen', emoji: 'ğŸœ', message: 'ë¼ë©´' },
            { name: 'ì§‘ë°¥', weight: 10, type: 'home', emoji: 'ğŸš', message: 'ëƒ‰ì¥ê³  í„¸ì–´ìš”' },
            { name: 'ë§›ì§‘', weight: 65, type: 'restaurant', emoji: 'ğŸ´', message: 'ë§›ì§‘ ì°¾ëŠ” ì¤‘...' }
        ];

        let isSpinning = false;
        let currentLocation = null;

        // ì¹´ì¹´ì˜¤ ë¡œì»¬ API ì„¤ì •
        // ğŸ”‘ ì¹´ì¹´ì˜¤ API í‚¤ ì„¤ì • ë°©ë²•:
        // 1. https://developers.kakao.com/ ì ‘ì†
        // 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„± í›„ REST API í‚¤ ë³µì‚¬
        // 3. config.js íŒŒì¼ì—ì„œ YOUR_KAKAO_API_KEYë¥¼ ì‹¤ì œ í‚¤ë¡œ êµì²´
        const KAKAO_API_KEY = window.CONFIG ? window.CONFIG.KAKAO_API_KEY : 'YOUR_KAKAO_API_KEY';
        const KAKAO_API_URL = window.CONFIG ? window.CONFIG.KAKAO_API_URL : 'https://dapi.kakao.com/v2/local/search/keyword.json';

        // ë„¤ì´ë²„ API ì„¤ì •
        const NAVER_CLIENT_ID = window.CONFIG ? window.CONFIG.NAVER_CLIENT_ID : 'YOUR_NAVER_CLIENT_ID';
        const NAVER_CLIENT_SECRET = window.CONFIG ? window.CONFIG.NAVER_CLIENT_SECRET : 'YOUR_NAVER_CLIENT_SECRET';
        const NAVER_SEARCH_API_URL = window.CONFIG ? window.CONFIG.NAVER_SEARCH_API_URL : 'https://openapi.naver.com/v1/search/local.json';

        // ë„¤ì´ë²„ APIë¡œ ìŒì‹ì  ê²€ìƒ‰ (ë” ë§ì€ ì •ë³´ ì œê³µ)
        async function searchRestaurantsWithNaver(lat, lng, radius = 1000) {
            try {
                // í˜„ì¬ ìœ„ì¹˜ ê¸°ë°˜ìœ¼ë¡œ ì§€ì—­ëª… ê²€ìƒ‰
                const locationQuery = await getLocationName(lat, lng);
                const query = `${locationQuery} ìŒì‹ì `;
                
                const params = new URLSearchParams({
                    query: query,
                    display: 15,  // ìµœëŒ€ 15ê°œ
                    start: 1,
                    sort: 'random'  // ëœë¤ ì •ë ¬
                });

                console.log('ë„¤ì´ë²„ API ìš”ì²­:', `http://localhost:8080/api/naver/search?${params}`);

                const response = await fetch(`http://localhost:8080/api/naver/search?${params}`);

                console.log('ë„¤ì´ë²„ API ì‘ë‹µ ìƒíƒœ:', response.status);

                if (!response.ok) {
                    throw new Error(`ë„¤ì´ë²„ API ìš”ì²­ ì‹¤íŒ¨: ${response.status}`);
                }

                const data = await response.json();
                console.log('ë„¤ì´ë²„ API ì‘ë‹µ ë°ì´í„°:', data);
                
                // ë„¤ì´ë²„ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë§›ì§‘ ì •ë³´ë¡œ ë³€í™˜
                const restaurants = [];
                if (data.items) {
                    for (const item of data.items) {
                        const details = await getNaverPlaceDetails(item.title.replace(/<[^>]*>/g, ''));
                        restaurants.push({
                            place_name: item.title.replace(/<[^>]*>/g, ''), // HTML íƒœê·¸ ì œê±°
                            address_name: item.address,
                            road_address_name: item.roadAddress,
                            phone: item.telephone,
                            category: item.category,
                            distance: calculateDistance(lat, lng, item.mapx, item.mapy),
                            // ë„¤ì´ë²„ì—ì„œ ì¶”ê°€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                            ...details
                        });
                    }
                }
                return restaurants;
            } catch (error) {
                console.error('ë„¤ì´ë²„ ìŒì‹ì  ê²€ìƒ‰ ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // ë„¤ì´ë²„ì—ì„œ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì˜ì—…ì‹œê°„, ë³„ì  ë“±)
        async function getNaverPlaceDetails(placeName) {
            try {
                // ë„¤ì´ë²„ ê²€ìƒ‰ APIë¡œ ìƒì„¸ ì •ë³´ ê²€ìƒ‰
                const searchParams = new URLSearchParams({
                    query: placeName,
                    display: 1,
                    start: 1
                });

                const searchResponse = await fetch(`http://localhost:8080/api/naver/search?${searchParams}`);
                
                if (searchResponse.ok) {
                    const searchData = await searchResponse.json();
                    if (searchData.items && searchData.items.length > 0) {
                        const item = searchData.items[0];
                        
                        // ì¹´í…Œê³ ë¦¬ì—ì„œ ìŒì‹ì  ì •ë³´ ì¶”ì¶œ
                        const category = item.category || '';
                        const isRestaurant = category.includes('ìŒì‹') || category.includes('ì‹ë‹¹');
                        
                        return {
                            opening_hours: isRestaurant ? 'ì˜ì—…ì‹œê°„ ì •ë³´ í™•ì¸ í•„ìš”' : 'ì •ë³´ ì—†ìŒ',
                            rating: 'N/A', // ë„¤ì´ë²„ ê²€ìƒ‰ APIì—ì„œëŠ” ë³„ì  ì •ë³´ê°€ ì œí•œì 
                            review_count: 0,
                            is_open: true,
                            category: category
                        };
                    }
                }
                
                return {
                    opening_hours: 'ì •ë³´ ì—†ìŒ',
                    rating: 'N/A',
                    review_count: 0,
                    is_open: true,
                    category: ''
                };
            } catch (error) {
                console.error('ë„¤ì´ë²„ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                return {
                    opening_hours: 'ì •ë³´ ì—†ìŒ',
                    rating: 'N/A',
                    review_count: 0,
                    is_open: true,
                    category: ''
                };
            }
        }

        // ì¢Œí‘œë¡œ ì§€ì—­ëª… ê°€ì ¸ì˜¤ê¸°
        async function getLocationName(lat, lng) {
            try {
                const response = await fetch(`https://dapi.kakao.com/v2/local/geo/coord2regioncode.json?x=${lng}&y=${lat}`, {
                    headers: {
                        'Authorization': `KakaoAK ${KAKAO_API_KEY}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.documents && data.documents.length > 0) {
                        return data.documents[0].address_name.split(' ')[1]; // êµ¬ ë‹¨ìœ„
                    }
                }
                return 'ìŒì‹ì ';
            } catch (error) {
                console.error('ì§€ì—­ëª… ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                return 'ìŒì‹ì ';
            }
        }

        // ë‘ ì§€ì  ê°„ ê±°ë¦¬ ê³„ì‚°
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // ì§€êµ¬ ë°˜ì§€ë¦„ (km)
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return Math.round(R * c * 1000); // ë¯¸í„° ë‹¨ìœ„
        }

        // ì¹´ì¹´ì˜¤ APIë¡œ ìŒì‹ì  ê²€ìƒ‰
        async function searchRestaurants(lat, lng, radius = 1000) {
            try {
                const params = new URLSearchParams({
                    query: 'ìŒì‹ì ',
                    x: lng,      // ê²½ë„
                    y: lat,      // ìœ„ë„  
                    radius: radius,
                    size: 15,    // ìµœëŒ€ 15ê°œ
                    category_group_code: 'FD6'  // ìŒì‹ì  ì¹´í…Œê³ ë¦¬
                });

                console.log('API ìš”ì²­ URL:', `${KAKAO_API_URL}?${params}`);
                console.log('API í‚¤:', KAKAO_API_KEY);

                const response = await fetch(`${KAKAO_API_URL}?${params}`, {
                    headers: {
                        'Authorization': `KakaoAK ${KAKAO_API_KEY}`
                    }
                });

                console.log('API ì‘ë‹µ ìƒíƒœ:', response.status);

                if (!response.ok) {
                    throw new Error(`API ìš”ì²­ ì‹¤íŒ¨: ${response.status}`);
                }

                const data = await response.json();
                console.log('API ì‘ë‹µ ë°ì´í„°:', data);
                
                return data.documents || [];
            } catch (error) {
                console.error('ìŒì‹ì  ê²€ìƒ‰ ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // ì˜ì—…ì‹œê°„ íŒŒì‹± ë° ì²´í¬ (ì¹´ì¹´ì˜¤ API ì‘ë‹µ êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì •)
        function parseOpeningHours(openingHours) {
            if (!openingHours) return null;
            
            // ì¹´ì¹´ì˜¤ API ì‘ë‹µì—ì„œ ì˜ì—…ì‹œê°„ ì •ë³´ ì¶”ì¶œ
            // ì˜ˆì‹œ: "ë§¤ì¼ 11:30 ~ 23:00" ë˜ëŠ” "ì›”-ê¸ˆ 09:00-18:00"
            const timeMatch = openingHours.match(/(\d{1,2}):(\d{2})\s*[~-]\s*(\d{1,2}):(\d{2})/);
            if (timeMatch) {
                const openHour = parseInt(timeMatch[1]);
                const openMinute = parseInt(timeMatch[2]);
                const closeHour = parseInt(timeMatch[3]);
                const closeMinute = parseInt(timeMatch[4]);
                
                return {
                    open: openHour * 60 + openMinute,
                    close: closeHour * 60 + closeMinute,
                    original: openingHours
                };
            }
            return null;
        }

        // í˜„ì¬ ì˜ì—…ì¤‘ì¸ì§€ í™•ì¸ (ë§ˆê° 1ì‹œê°„ ì „ê¹Œì§€ë§Œ)
        function isRestaurantAvailable(restaurant, currentTime) {
            // ì˜ì—…ì‹œê°„ ì •ë³´ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ ì²´í¬
            const hours = parseOpeningHours(restaurant.opening_hours);
            if (!hours) {
                // ì˜ì—…ì‹œê°„ ì •ë³´ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ì´ìš© ê°€ëŠ¥
                return true;
            }
            
            // í˜„ì¬ ì‹œê°„ì´ ì˜ì—…ì‹œê°„ ë‚´ì¸ì§€ í™•ì¸
            const isCurrentlyOpen = currentTime >= hours.open && currentTime <= hours.close;
            
            // ë§ˆê° 1ì‹œê°„ ì „ê¹Œì§€ë§Œ ì´ìš© ê°€ëŠ¥
            const oneHourBeforeClosing = hours.close - 60;
            const hasEnoughTime = currentTime <= oneHourBeforeClosing;
            
            console.log(`ìŒì‹ì : ${restaurant.place_name}`);
            console.log(`í˜„ì¬ì‹œê°„: ${Math.floor(currentTime/60)}:${currentTime%60}`);
            console.log(`ì˜ì—…ì‹œê°„: ${Math.floor(hours.open/60)}:${hours.open%60} ~ ${Math.floor(hours.close/60)}:${hours.close%60}`);
            console.log(`ì˜ì—…ì¤‘: ${isCurrentlyOpen}, ì¶©ë¶„í•œì‹œê°„: ${hasEnoughTime}`);
            
            return isCurrentlyOpen && hasEnoughTime;
        }

        // ëœë¤ ë§›ì§‘ ì„ íƒ
        async function getRandomRestaurant(lat, lng) {
            try {
                // í˜„ì¬ ì‹œê°„
                const now = new Date();
                const currentHour = now.getHours();
                const currentMinutes = now.getMinutes();
                const currentTime = currentHour * 60 + currentMinutes; // ë¶„ìœ¼ë¡œ ë³€í™˜
                
                // ì¹´ì¹´ì˜¤ APIë¡œ 1km ë‚´ ëª¨ë“  ìŒì‹ì  ê²€ìƒ‰ (ì•ˆì •ì )
                const allRestaurants = await searchRestaurants(lat, lng, 1000);
                
                console.log('ê²€ìƒ‰ëœ ìŒì‹ì :', allRestaurants);
                
                // ì˜ì—…ì¤‘ + ë§ˆê° 1ì‹œê°„ ì „ê¹Œì§€ë§Œ í•„í„°ë§
                const availableRestaurants = allRestaurants.filter(restaurant => {
                    return isRestaurantAvailable(restaurant, currentTime);
                });
                
                console.log('ì´ìš© ê°€ëŠ¥í•œ ìŒì‹ì :', availableRestaurants);
                
                if (availableRestaurants.length === 0) {
                    throw new Error('í˜„ì¬ ì´ìš© ê°€ëŠ¥í•œ ë§›ì§‘ì´ ì—†ìŠµë‹ˆë‹¤');
                }
                
                // í•„í„°ë§ëœ ê²°ê³¼ì—ì„œ ëœë¤ ì„ íƒ
                const randomIndex = Math.floor(Math.random() * availableRestaurants.length);
                return availableRestaurants[randomIndex];
            } catch (error) {
                console.error('ë§›ì§‘ ì„ íƒ ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // ì§€ë„ë³´ê¸° ê¸°ëŠ¥
        function openMap(placeName, x, y) {
            // ì¹´ì¹´ì˜¤ë§µìœ¼ë¡œ ì—´ê¸°
            const url = `https://map.kakao.com/link/map/${placeName},${y},${x}`;
            window.open(url, '_blank');
        }

        // ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        function getCurrentLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocationì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'));
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        currentLocation = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        };
                        console.log('í˜„ì¬ ìœ„ì¹˜:', currentLocation);
                        resolve(currentLocation);
                    },
                    (error) => {
                        console.error('ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                        reject(error);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            });
        }

        // ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­ ë° í™•ì¸
        async function requestLocationPermission() {
            try {
                await getCurrentLocation();
                return true;
            } catch (error) {
                console.error('ìœ„ì¹˜ ê¶Œí•œ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­
        window.addEventListener('load', async () => {
            const hasLocation = await requestLocationPermission();
            if (!hasLocation) {
                console.log('ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë§›ì§‘ ê¸°ëŠ¥ì€ ì œí•œë©ë‹ˆë‹¤.');
            }
        });

        function weightedRandom(choices) {
            const totalWeight = choices.reduce((sum, choice) => sum + choice.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (let choice of choices) {
                random -= choice.weight;
                if (random <= 0) return choice;
            }
            return choices[choices.length - 1]; // fallback
        }

        async function spinRoulette() {
            if (isSpinning) return;
            
            isSpinning = true;
            const roulette = document.getElementById('roulette');
            const rouletteText = document.getElementById('rouletteText');
            const result = document.getElementById('result');
            
            // ë£°ë › ë¹„í™œì„±í™” (í´ë¦­ ë°©ì§€)
            roulette.style.pointerEvents = 'none';
            rouletteText.textContent = 'ëŒë¦¬ëŠ” ì¤‘...';
            
                        // ìŒì‹ ë¹„ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            createFoodRain();
            
            // ë£°ë › íšŒì „ ì• ë‹ˆë©”ì´ì…˜
            roulette.classList.add('spinning');
            
            // ëœë¤ ì„ íƒ
            const selectedChoice = weightedRandom(choices);
            
            setTimeout(async () => {
                roulette.classList.remove('spinning');
                rouletteText.textContent = 'í´ë¦­!';
                
                // ê²°ê³¼ í‘œì‹œ
                if (selectedChoice.type === 'restaurant') {
                    result.innerHTML = '<div class="loading">ğŸ´ ë§›ì§‘ ì°¾ëŠ” ì¤‘...</div>';
                    
                    // ìœ„ì¹˜ ì •ë³´ í™•ì¸
                    if (!currentLocation) {
                        try {
                            await getCurrentLocation();
                        } catch (error) {
                            result.innerHTML = '<div class="restaurant-info"><div class="restaurant-name">âš ï¸ ìœ„ì¹˜ ì •ë³´ í•„ìš”</div><div class="restaurant-details">ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.<br>ë§›ì§‘ ì¶”ì²œì„ ìœ„í•´ í˜„ì¬ ìœ„ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.</div></div>';
                            roulette.style.pointerEvents = 'auto';
                            isSpinning = false;
                            return;
                        }
                    }
                    
                    // ì‹¤ì œ ë§›ì§‘ API í˜¸ì¶œ
                    try {
                        const restaurant = await getRandomRestaurant(currentLocation.latitude, currentLocation.longitude);
                        
                        console.log('ì„ íƒëœ ë§›ì§‘:', restaurant);
                        
                        // ê±°ë¦¬ ê³„ì‚° (ì‹¤ì œ ê±°ë¦¬ ì •ë³´ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ì„ì‹œ)
                        const distance = restaurant.distance ? Math.round(restaurant.distance) : Math.round(Math.random() * 800 + 200);
                        
                        // ë§ˆê°ì‹œê°„ ê³„ì‚°
                        const hours = parseOpeningHours(restaurant.opening_hours);
                        let closingTime = 'ì •ë³´ ì—†ìŒ';
                        let isOpen = 'ì˜ì—…ì¤‘';
                        
                        if (hours && hours.original) {
                            closingTime = hours.original;
                            // ê°„ë‹¨í•œ ì˜ì—…ì¤‘ ì²´í¬ (í˜„ì¬ ì‹œê°„ì´ ì˜ì—…ì‹œê°„ ë‚´ì¸ì§€)
                            const now = new Date();
                            const currentTime = now.getHours() * 60 + now.getMinutes();
                            if (currentTime >= hours.open && currentTime <= hours.close) {
                                isOpen = 'ì˜ì—…ì¤‘';
                            } else {
                                isOpen = 'ì˜ì—…ì¢…ë£Œ';
                            }
                        } else {
                            isOpen = 'ì˜ì—…ì •ë³´ ì—†ìŒ';
                        }
                        
                        // ë³„ì  ì •ë³´ (ì¹´ì¹´ì˜¤ APIì—ì„œëŠ” ë³„ì  ì •ë³´ê°€ ì œí•œì )
                        const rating = restaurant.rating || 'N/A';
                        const category = restaurant.category_name || '';
                        
                        // ê°€ì¥ í•˜ìœ„ ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ
                        let subCategory = '';
                        if (category) {
                            const categories = category.split(' > ');
                            subCategory = categories[categories.length - 1] || '';
                        }
                        
                        result.innerHTML = `
                            <div class="restaurant-info">
                                <div class="restaurant-category">${subCategory || 'ë§›ì§‘'}</div>
                                <div class="restaurant-name">ğŸ´ ${restaurant.place_name} (${distance}m)</div>
                                <button onclick="openMap('${restaurant.place_name}', ${restaurant.x}, ${restaurant.y})" 
                                        style="margin-top: 1.5rem; padding: 0.8rem 1.5rem; background: #FF69B4; color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 1.2rem; font-weight: 600;">
                                    ğŸ—ºï¸ ì§€ë„ë³´ê¸°
                                </button>
                            </div>
                        `;
                    } catch (error) {
                        if (error.message.includes('ì´ìš© ê°€ëŠ¥í•œ ë§›ì§‘ì´ ì—†ìŠµë‹ˆë‹¤')) {
                            result.innerHTML = '<div class="restaurant-info"><div class="restaurant-name">ğŸ˜” ì´ìš© ê°€ëŠ¥í•œ ë§›ì§‘ì´ ì—†ì–´ìš”</div><div class="restaurant-details">ë§ˆê°ì´ ì„ë°•í–ˆê±°ë‚˜ ì˜ì—…ì¤‘ì¸ ê³³ì´ ì—†ìŠµë‹ˆë‹¤.<br>ë‹¤ì‹œ ëŒë ¤ë³´ì„¸ìš”!</div></div>';
                        } else {
                            result.innerHTML = '<div class="restaurant-info"><div class="restaurant-name">âš ï¸ ë§›ì§‘ ê²€ìƒ‰ ì‹¤íŒ¨</div><div class="restaurant-details">ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div></div>';
                        }
                    }
                } else {
                    result.innerHTML = `${selectedChoice.emoji}${selectedChoice.message}${selectedChoice.emoji}`;
                }
                
                roulette.style.pointerEvents = 'auto';
                isSpinning = false;
            }, 3000);
        }

        // ìŒì‹ ë¹„ ì• ë‹ˆë©”ì´ì…˜
        function createFoodRain() {
            const foodRain = document.getElementById('foodRain');
            const foods = [
                'ğŸ•', 'ğŸœ', 'ğŸ—', 'ğŸ”', 'ğŸ', 'ğŸ™', 'ğŸ¢', 'ğŸ£', 'ğŸ¥“', 'ğŸŒ®', 'ğŸ¥—', 
                'ğŸ•', 'ğŸœ', 'ğŸ—', 'ğŸ”', 'ğŸ', 'ğŸ™', 'ğŸ¢', 'ğŸ£', 'ğŸ¥“', 'ğŸŒ®', 'ğŸ¥—',
                'ğŸ•', 'ğŸœ', 'ğŸ—', 'ğŸ”', 'ğŸ', 'ğŸ™', 'ğŸ¢', 'ğŸ£', 'ğŸ¥“', 'ğŸŒ®', 'ğŸ¥—'
            ];
            
            // ê¸°ì¡´ ìŒì‹ ìš”ì†Œë“¤ ì œê±°
            foodRain.innerHTML = '';
            
            // 20ê°œì˜ ìŒì‹ì„ ëœë¤í•˜ê²Œ ìƒì„±
            for (let i = 0; i < 20; i++) {
                const food = document.createElement('div');
                food.className = 'falling-food';
                food.textContent = foods[Math.floor(Math.random() * foods.length)];
                
                // ëœë¤ ìœ„ì¹˜ì™€ ì§€ì—°ì‹œê°„
                food.style.left = Math.random() * 100 + '%';
                food.style.animationDelay = Math.random() * 2 + 's';
                food.style.animationDuration = (Math.random() * 1 + 2) + 's';
                
                // ëœë¤ íšŒì „ ë°©í–¥
                const rotation = Math.random() > 0.5 ? 360 : -360;
                food.style.setProperty('--rotation', rotation + 'deg');
                
                foodRain.appendChild(food);
                
                // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ ìš”ì†Œ ì œê±°
                setTimeout(() => {
                    if (food.parentNode) {
                        food.remove();
                    }
                }, 5000);
            }
        }

                // ìŒì‹ ì´ëª¨ì§€ ë°°ì—´
        const foodEmojis = ['ğŸ•', 'ğŸœ', 'ğŸ—', 'ğŸ”', 'ğŸ', 'ğŸ™', 'ğŸ¢', 'ğŸ£', 'ğŸ¥“', 'ğŸ', 'ğŸŒ®', 'ğŸ¥—'];



        
    </script>
</body>
</html> 